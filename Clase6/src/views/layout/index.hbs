<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”¥ Ejemplo HBS</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    {{{body}}}
    <div class="page-content page-container" id="page-content">
        <div class="padding">
            <div class="row container d-flex justify-content-center">
                <div class="col-md-6">
                    <div class="card card-bordered">
                        <div class="card-header">
                            <h4 class="card-title"><strong>Chat</strong></h4>
                        </div>
                        <div class="ps-container ps-theme-default ps-active-y" id="chat-content" style="overflow-y: scroll !important; height:400px !important;">
                            
                            <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 0px;">
                                <div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                            </div>
                            <div class="ps-scrollbar-y-rail" style="top: 0px; height: 0px; right: 2px;">
                                <div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 2px;"></div>
                            </div>
                        </div>
                        <form onSubmit="addMessage(); return false"><div class="publisher bt-1 border-light"> <img class="avatar avatar-xs" src="https://img.icons8.com/color/36/000000/administrator-male.png" alt="..."> <input class="publisher-input" type="text" name="mail" id="mail" placeholder="email"><input class="publisher-input" type="text" name="message" id="message" placeholder="Escribe algo"><button id="send" type="submit" class="publisher-btn text-info" href="#" data-abc="true"><i class="fa fa-paper-plane"></i></button> </div></form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const socket = io()
        let usuario;
        
    socket.on('mensajeConexion',(data)=>{
      usuario = data;
    })

      socket.on('messageBack',(data)=>{
      console.log('hola')
      console.log('Recibida desde backend: ',data)
      let innerText =''
      data.map((message)=>{
        innerText+=`
        <div class="${classMensaje(message.author, usuario)}"> <img class="avatar" src="https://img.icons8.com/color/36/000000/administrator-male.png" alt="...">
            <div class="media-body">
                <p class="meta"><FONT COLOR="#2159ff"><b>${message.mail}</b></FONT></p>
                <p><i>${message.text}</i></p>
                <p class="meta"><time datetime="2018"><FONT COLOR="#a3a3a3">${message.date}</FONT></time></p>
            </div>
        </div>
        `
      })
      document.getElementById('chat-content').innerHTML= innerText
    })

    function classMensaje(id, usuario){
        if(id == usuario){
            return "media media-chat media-chat-reverse";
    }else {
        return "media media-chat";
    }}

    function addMessage(){
      const author = socket.id
      let date = ""
      const mail = document.getElementById('mail').value
      const text = document.getElementById('message').value
      socket.emit('messageFront',{
        author,
        mail,
        text,
        date,       
     })
      document.getElementById('message').value=''
    }
    </script>

</body>
</html>